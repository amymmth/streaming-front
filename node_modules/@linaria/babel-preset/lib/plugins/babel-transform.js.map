{"version":3,"file":"babel-transform.js","names":["_logger","require","_utils","_cache","_transform","_loadLinariaOptions","_interopRequireDefault","_collector","obj","__esModule","default","babelTransform","babel","options","cache","TransformCacheCollection","name","pre","file","_file$opts$root","_file$opts$inputSourc","collect","valueCache","data","loadedAndParsed","entrypoint","pluginOptions","services","evaluator","Error","collector","ast","code","debug","opts","filename","loadLinariaOptions","transformSync","root","undefined","inputSourceMap","syncResolve","visitor","post"],"sources":["../../src/plugins/babel-transform.ts"],"sourcesContent":["import type { BabelFile, PluginObj } from '@babel/core';\n\nimport { debug } from '@linaria/logger';\nimport { syncResolve } from '@linaria/utils';\n\nimport type { Core } from '../babel';\nimport { TransformCacheCollection } from '../cache';\nimport { transformSync } from '../transform';\nimport loadLinariaOptions from '../transform/helpers/loadLinariaOptions';\nimport type { ICollectAction, SyncScenarioForAction } from '../transform/types';\nimport type { IPluginState, PluginOptions } from '../types';\n\nimport { collector } from './collector';\n\nexport default function babelTransform(\n  babel: Core,\n  options: Partial<PluginOptions>\n): PluginObj<IPluginState> {\n  const cache = new TransformCacheCollection();\n\n  return {\n    name: '@linaria/babel/babel-transform',\n    pre(file: BabelFile) {\n      // eslint-disable-next-line require-yield\n      function* collect(\n        this: ICollectAction\n      ): SyncScenarioForAction<ICollectAction> {\n        const { valueCache } = this.data;\n        const { loadedAndParsed } = this.entrypoint;\n        const { pluginOptions } = this.services.options;\n        if (loadedAndParsed.evaluator === 'ignored') {\n          throw new Error('entrypoint was ignored');\n        }\n\n        collector(file, pluginOptions, valueCache);\n\n        return {\n          ast: loadedAndParsed.ast,\n          code: loadedAndParsed.code,\n        };\n      }\n\n      debug('babel-transform:start', file.opts.filename);\n\n      const pluginOptions = loadLinariaOptions(options);\n\n      transformSync(\n        {\n          babel,\n          cache,\n          options: {\n            filename: file.opts.filename!,\n            root: file.opts.root ?? undefined,\n            inputSourceMap: file.opts.inputSourceMap ?? undefined,\n            pluginOptions,\n          },\n        },\n        file.code,\n        syncResolve,\n        {\n          collect,\n        }\n      );\n    },\n    visitor: {},\n    post(file: BabelFile) {\n      debug('babel-transform:end', file.opts.filename);\n    },\n  };\n}\n"],"mappings":";;;;;;AAEA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AAGA,IAAAE,MAAA,GAAAF,OAAA;AACA,IAAAG,UAAA,GAAAH,OAAA;AACA,IAAAI,mBAAA,GAAAC,sBAAA,CAAAL,OAAA;AAIA,IAAAM,UAAA,GAAAN,OAAA;AAAwC,SAAAK,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEzB,SAASG,cAAcA,CACpCC,KAAW,EACXC,OAA+B,EACN;EACzB,MAAMC,KAAK,GAAG,IAAIC,+BAAwB,CAAC,CAAC;EAE5C,OAAO;IACLC,IAAI,EAAE,gCAAgC;IACtCC,GAAGA,CAACC,IAAe,EAAE;MAAA,IAAAC,eAAA,EAAAC,qBAAA;MACnB;MACA,UAAUC,OAAOA,CAAA,EAEwB;QACvC,MAAM;UAAEC;QAAW,CAAC,GAAG,IAAI,CAACC,IAAI;QAChC,MAAM;UAAEC;QAAgB,CAAC,GAAG,IAAI,CAACC,UAAU;QAC3C,MAAM;UAAEC;QAAc,CAAC,GAAG,IAAI,CAACC,QAAQ,CAACd,OAAO;QAC/C,IAAIW,eAAe,CAACI,SAAS,KAAK,SAAS,EAAE;UAC3C,MAAM,IAAIC,KAAK,CAAC,wBAAwB,CAAC;QAC3C;QAEA,IAAAC,oBAAS,EAACZ,IAAI,EAAEQ,aAAa,EAAEJ,UAAU,CAAC;QAE1C,OAAO;UACLS,GAAG,EAAEP,eAAe,CAACO,GAAG;UACxBC,IAAI,EAAER,eAAe,CAACQ;QACxB,CAAC;MACH;MAEA,IAAAC,aAAK,EAAC,uBAAuB,EAAEf,IAAI,CAACgB,IAAI,CAACC,QAAQ,CAAC;MAElD,MAAMT,aAAa,GAAG,IAAAU,2BAAkB,EAACvB,OAAO,CAAC;MAEjD,IAAAwB,wBAAa,EACX;QACEzB,KAAK;QACLE,KAAK;QACLD,OAAO,EAAE;UACPsB,QAAQ,EAAEjB,IAAI,CAACgB,IAAI,CAACC,QAAS;UAC7BG,IAAI,GAAAnB,eAAA,GAAED,IAAI,CAACgB,IAAI,CAACI,IAAI,cAAAnB,eAAA,cAAAA,eAAA,GAAIoB,SAAS;UACjCC,cAAc,GAAApB,qBAAA,GAAEF,IAAI,CAACgB,IAAI,CAACM,cAAc,cAAApB,qBAAA,cAAAA,qBAAA,GAAImB,SAAS;UACrDb;QACF;MACF,CAAC,EACDR,IAAI,CAACc,IAAI,EACTS,kBAAW,EACX;QACEpB;MACF,CACF,CAAC;IACH,CAAC;IACDqB,OAAO,EAAE,CAAC,CAAC;IACXC,IAAIA,CAACzB,IAAe,EAAE;MACpB,IAAAe,aAAK,EAAC,qBAAqB,EAAEf,IAAI,CAACgB,IAAI,CAACC,QAAQ,CAAC;IAClD;EACF,CAAC;AACH"}