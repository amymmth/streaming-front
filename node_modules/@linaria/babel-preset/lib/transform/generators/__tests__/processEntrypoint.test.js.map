{"version":3,"file":"processEntrypoint.test.js","names":["_entrypointHelpers","require","_processEntrypoint","_helpers","describe","services","beforeEach","createServices","it","fooBarDefault","createEntrypoint","action","createAction","undefined","gen","processEntrypoint","call","result","next","expectIteratorYieldResult","expect","value","toBe","expectIteratorReturnResult","emitted","filter","isIteratorYieldResult","map","emittedSignals","a","signal","aborted","toEqual","supersededWith","nextResult","abortController","AbortController","abort"],"sources":["../../../../src/transform/generators/__tests__/processEntrypoint.test.ts"],"sourcesContent":["import {\n  createEntrypoint,\n  createServices,\n} from '../../__tests__/entrypoint-helpers';\nimport type { Services } from '../../types';\nimport { processEntrypoint } from '../processEntrypoint';\n\nimport {\n  expectIteratorReturnResult,\n  expectIteratorYieldResult,\n  isIteratorYieldResult,\n} from './helpers';\n\ndescribe('processEntrypoint', () => {\n  let services: Services;\n  beforeEach(() => {\n    services = createServices();\n  });\n\n  it('should emit explodeReexports, transform and finalizeEntrypoint actions', () => {\n    const fooBarDefault = createEntrypoint(services, '/foo/bar.js', [\n      'default',\n    ]);\n\n    // const action = createAction('processEntrypoint', fooBarDefault, {}, null);\n    const action = fooBarDefault.createAction(\n      'processEntrypoint',\n      undefined,\n      null\n    );\n    const gen = processEntrypoint.call(action);\n\n    let result = gen.next();\n    expectIteratorYieldResult(result);\n\n    expect(result.value[0]).toBe('explodeReexports');\n    expect(result.value[1]).toBe(fooBarDefault);\n\n    result = gen.next();\n    expectIteratorYieldResult(result);\n    expect(result.value[0]).toBe('transform');\n    expect(result.value[1]).toBe(fooBarDefault);\n\n    expectIteratorReturnResult(gen.next(), undefined);\n  });\n\n  it('should abort previously emitted actions if entrypoint was superseded and emit a new processEntrypoint', () => {\n    const fooBarDefault = createEntrypoint(services, '/foo/bar.js', [\n      'default',\n    ]);\n\n    const action = fooBarDefault.createAction(\n      'processEntrypoint',\n      undefined,\n      null\n    );\n    const gen = processEntrypoint.call(action);\n\n    const emitted = [gen.next(), gen.next()]\n      .filter(isIteratorYieldResult)\n      .map((result) => result.value);\n    expect(emitted[0][0]).toBe('explodeReexports');\n    expect(emitted[1][0]).toBe('transform');\n\n    const emittedSignals = emitted.map((a) => a[3]);\n    expect(emittedSignals.map((signal) => signal?.aborted)).toEqual([\n      false,\n      false,\n    ]);\n\n    const supersededWith = createEntrypoint(services, '/foo/bar.js', ['named']);\n    expect(emittedSignals.map((signal) => signal?.aborted)).toEqual([\n      true,\n      true,\n    ]);\n\n    const nextResult = gen.next();\n    expectIteratorYieldResult(nextResult);\n    expect(nextResult.value[0]).toBe('processEntrypoint');\n    expect(nextResult.value[1]).toBe(supersededWith);\n  });\n\n  it('should abort previously emitted actions if parent aborts', () => {\n    const fooBarDefault = createEntrypoint(services, '/foo/bar.js', [\n      'default',\n    ]);\n\n    const abortController = new AbortController();\n    const action = fooBarDefault.createAction(\n      'processEntrypoint',\n      undefined,\n      abortController.signal\n    );\n    const gen = processEntrypoint.call(action);\n\n    const emitted = [gen.next(), gen.next()]\n      .filter(isIteratorYieldResult)\n      .map((result) => result.value);\n    expect(emitted[0][0]).toBe('explodeReexports');\n    expect(emitted[1][0]).toBe('transform');\n\n    const emittedSignals = emitted.map((a) => a[3]);\n    expect(emittedSignals.map((signal) => signal?.aborted)).toEqual([\n      false,\n      false,\n    ]);\n\n    abortController.abort();\n\n    expect(emittedSignals.map((signal) => signal?.aborted)).toEqual([\n      true,\n      true,\n    ]);\n\n    expectIteratorReturnResult(gen.next(), undefined);\n  });\n});\n"],"mappings":"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"}