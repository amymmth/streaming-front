{"version":3,"file":"createEntrypoint.test.js","names":["_entrypointHelpers","require","describe","services","beforeEach","createServices","it","entrypoint","createEntrypoint","expect","toMatchObject","name","only","parents","entrypoint1","entrypoint2","toBe","not","supersededWith","callback","jest","fn","onSupersede","toBeCalledWith","unsubscribe","toBeCalled"],"sources":["../../../src/transform/__tests__/createEntrypoint.test.ts"],"sourcesContent":["import type { Services } from '../types';\n\nimport { createEntrypoint, createServices } from './entrypoint-helpers';\n\ndescribe('createEntrypoint', () => {\n  let services: Services;\n\n  beforeEach(() => {\n    services = createServices();\n  });\n\n  it('should create a new entrypoint', () => {\n    const entrypoint = createEntrypoint(services, '/foo/bar.js', ['default']);\n    expect(entrypoint).toMatchObject({\n      name: '/foo/bar.js',\n      only: ['default'],\n      parents: [],\n    });\n  });\n\n  it('should take from cache', () => {\n    const entrypoint1 = createEntrypoint(services, '/foo/bar.js', ['default']);\n    const entrypoint2 = createEntrypoint(services, '/foo/bar.js', ['default']);\n    expect(entrypoint1).toBe(entrypoint2);\n  });\n\n  it('should invalidate cache if source code was changed', () => {\n    const entrypoint1 = createEntrypoint(\n      services,\n      '/foo/bar.js',\n      ['default'],\n      'foo'\n    );\n    const entrypoint2 = createEntrypoint(\n      services,\n      '/foo/bar.js',\n      ['default'],\n      'bar'\n    );\n    expect(entrypoint1).not.toBe(entrypoint2);\n    expect(entrypoint1.supersededWith).toBe(entrypoint2);\n  });\n\n  it('should not take from cache if path differs', () => {\n    const entrypoint1 = createEntrypoint(services, '/foo/bar.js', ['default']);\n    const entrypoint2 = createEntrypoint(services, '/foo/baz.js', ['default']);\n    expect(entrypoint1).not.toBe(entrypoint2);\n    expect(entrypoint1).toMatchObject({\n      name: '/foo/bar.js',\n      only: ['default'],\n    });\n    expect(entrypoint2).toMatchObject({\n      name: '/foo/baz.js',\n      only: ['default'],\n    });\n  });\n\n  it('should not take from cache if only differs', () => {\n    const entrypoint1 = createEntrypoint(services, '/foo/bar.js', ['default']);\n    const entrypoint2 = createEntrypoint(services, '/foo/bar.js', ['named']);\n    expect(entrypoint1).not.toBe(entrypoint2);\n    expect(entrypoint1.supersededWith).toBe(entrypoint2);\n    expect(entrypoint2).toMatchObject({\n      name: '/foo/bar.js',\n      only: ['default', 'named'],\n    });\n  });\n\n  it('should take from cache if only is subset of cached', () => {\n    const entrypoint1 = createEntrypoint(services, '/foo/bar.js', [\n      'default',\n      'named',\n    ]);\n    const entrypoint2 = createEntrypoint(services, '/foo/bar.js', ['default']);\n    expect(entrypoint1).toBe(entrypoint2);\n  });\n\n  it('should take from cache if wildcard is cached', () => {\n    const entrypoint1 = createEntrypoint(services, '/foo/bar.js', ['*']);\n    const entrypoint2 = createEntrypoint(services, '/foo/bar.js', ['default']);\n    expect(entrypoint1).toBe(entrypoint2);\n  });\n\n  it('should call callback if entrypoint was superseded', () => {\n    const callback = jest.fn();\n    const entrypoint1 = createEntrypoint(services, '/foo/bar.js', ['default']);\n\n    entrypoint1.onSupersede(callback);\n\n    const entrypoint2 = createEntrypoint(services, '/foo/bar.js', ['named']);\n    expect(entrypoint1).not.toBe(entrypoint2);\n    expect(entrypoint1.supersededWith).toBe(entrypoint2);\n    expect(callback).toBeCalledWith(entrypoint2);\n  });\n\n  it('should not call supersede callback if it was unsubscribed', () => {\n    const callback = jest.fn();\n    const entrypoint1 = createEntrypoint(services, '/foo/bar.js', ['default']);\n\n    const unsubscribe = entrypoint1.onSupersede(callback);\n    unsubscribe();\n\n    const entrypoint2 = createEntrypoint(services, '/foo/bar.js', ['named']);\n    expect(entrypoint1).not.toBe(entrypoint2);\n    expect(entrypoint1.supersededWith).toBe(entrypoint2);\n    expect(callback).not.toBeCalled();\n  });\n});\n"],"mappings":"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"}