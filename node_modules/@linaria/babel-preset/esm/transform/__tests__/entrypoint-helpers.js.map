{"version":3,"file":"entrypoint-helpers.js","names":["babel","EventEmitter","TransformCacheCollection","Entrypoint","rootLog","emptyHandler","undefined","getHandlers","partial","collect","jest","fn","evalFile","explodeReexports","extract","getExports","processEntrypoint","processImports","resolveImports","transform","workflow","createServices","cache","loadAndParseFn","ast","code","evaluator","evalConfig","log","eventEmitter","dummy","options","createEntrypoint","services","name","only","entrypoint","createRoot","ignored","Error"],"sources":["../../../src/transform/__tests__/entrypoint-helpers.ts"],"sourcesContent":["import * as babel from '@babel/core';\nimport type { File } from '@babel/types';\n\nimport { EventEmitter } from '@linaria/utils';\n\nimport { TransformCacheCollection } from '../../cache';\nimport { Entrypoint } from '../Entrypoint';\nimport type { LoadAndParseFn } from '../Entrypoint.types';\nimport { rootLog } from '../rootLog';\nimport type {\n  Services,\n  Handlers,\n  ActionQueueItem,\n  SyncScenarioForAction,\n  ICollectAction,\n  IEvalAction,\n  IExplodeReexportsAction,\n  IExtractAction,\n  IGetExportsAction,\n  IProcessEntrypointAction,\n  IProcessImportsAction,\n  IResolveImportsAction,\n  ITransformAction,\n  IWorkflowAction,\n} from '../types';\n\nexport type SyncHandlers<TMode extends 'async' | 'sync'> = Handlers<TMode>;\n\n// eslint-disable-next-line require-yield\nfunction* emptyHandler<\n  TAction extends ActionQueueItem,\n>(): SyncScenarioForAction<TAction> {\n  return undefined as never;\n}\n\nexport const getHandlers = <TMode extends 'async' | 'sync'>(\n  partial: Partial<SyncHandlers<TMode>>\n) => ({\n  collect: jest.fn(emptyHandler<ICollectAction>),\n  evalFile: jest.fn(emptyHandler<IEvalAction>),\n  explodeReexports: jest.fn(emptyHandler<IExplodeReexportsAction>),\n  extract: jest.fn(emptyHandler<IExtractAction>),\n  getExports: jest.fn(emptyHandler<IGetExportsAction>),\n  processEntrypoint: jest.fn(emptyHandler<IProcessEntrypointAction>),\n  processImports: jest.fn(emptyHandler<IProcessImportsAction>),\n  resolveImports: jest.fn(emptyHandler<IResolveImportsAction>),\n  transform: jest.fn(emptyHandler<ITransformAction>),\n  workflow: jest.fn(emptyHandler<IWorkflowAction>),\n  ...partial,\n});\n\nexport const createServices: () => Services = () => ({\n  babel,\n  cache: new TransformCacheCollection(),\n  loadAndParseFn: jest.fn<ReturnType<LoadAndParseFn>, []>(() => ({\n    ast: {} as File,\n    code: '',\n    evaluator: jest.fn(),\n    evalConfig: {},\n  })),\n  log: rootLog,\n  eventEmitter: EventEmitter.dummy,\n  options: {} as Services['options'],\n});\n\nexport const createEntrypoint = (\n  services: Services,\n  name: string,\n  only: string[],\n  code?: string\n) => {\n  const entrypoint = Entrypoint.createRoot(services, name, only, code);\n\n  if (entrypoint.ignored) {\n    throw new Error('entrypoint was ignored');\n  }\n\n  return entrypoint;\n};\n"],"mappings":"AAAA,OAAO,KAAKA,KAAK,MAAM,aAAa;AAGpC,SAASC,YAAY,QAAQ,gBAAgB;AAE7C,SAASC,wBAAwB,QAAQ,aAAa;AACtD,SAASC,UAAU,QAAQ,eAAe;AAE1C,SAASC,OAAO,QAAQ,YAAY;AAoBpC;AACA,UAAUC,YAAYA,CAAA,EAEc;EAClC,OAAOC,SAAS;AAClB;AAEA,OAAO,MAAMC,WAAW,GACtBC,OAAqC,KACjC;EACJC,OAAO,EAAEC,IAAI,CAACC,EAAE,CAACN,YAA4B,CAAC;EAC9CO,QAAQ,EAAEF,IAAI,CAACC,EAAE,CAACN,YAAyB,CAAC;EAC5CQ,gBAAgB,EAAEH,IAAI,CAACC,EAAE,CAACN,YAAqC,CAAC;EAChES,OAAO,EAAEJ,IAAI,CAACC,EAAE,CAACN,YAA4B,CAAC;EAC9CU,UAAU,EAAEL,IAAI,CAACC,EAAE,CAACN,YAA+B,CAAC;EACpDW,iBAAiB,EAAEN,IAAI,CAACC,EAAE,CAACN,YAAsC,CAAC;EAClEY,cAAc,EAAEP,IAAI,CAACC,EAAE,CAACN,YAAmC,CAAC;EAC5Da,cAAc,EAAER,IAAI,CAACC,EAAE,CAACN,YAAmC,CAAC;EAC5Dc,SAAS,EAAET,IAAI,CAACC,EAAE,CAACN,YAA8B,CAAC;EAClDe,QAAQ,EAAEV,IAAI,CAACC,EAAE,CAACN,YAA6B,CAAC;EAChD,GAAGG;AACL,CAAC,CAAC;AAEF,OAAO,MAAMa,cAA8B,GAAGA,CAAA,MAAO;EACnDrB,KAAK;EACLsB,KAAK,EAAE,IAAIpB,wBAAwB,CAAC,CAAC;EACrCqB,cAAc,EAAEb,IAAI,CAACC,EAAE,CAAiC,OAAO;IAC7Da,GAAG,EAAE,CAAC,CAAS;IACfC,IAAI,EAAE,EAAE;IACRC,SAAS,EAAEhB,IAAI,CAACC,EAAE,CAAC,CAAC;IACpBgB,UAAU,EAAE,CAAC;EACf,CAAC,CAAC,CAAC;EACHC,GAAG,EAAExB,OAAO;EACZyB,YAAY,EAAE5B,YAAY,CAAC6B,KAAK;EAChCC,OAAO,EAAE,CAAC;AACZ,CAAC,CAAC;AAEF,OAAO,MAAMC,gBAAgB,GAAGA,CAC9BC,QAAkB,EAClBC,IAAY,EACZC,IAAc,EACdV,IAAa,KACV;EACH,MAAMW,UAAU,GAAGjC,UAAU,CAACkC,UAAU,CAACJ,QAAQ,EAAEC,IAAI,EAAEC,IAAI,EAAEV,IAAI,CAAC;EAEpE,IAAIW,UAAU,CAACE,OAAO,EAAE;IACtB,MAAM,IAAIC,KAAK,CAAC,wBAAwB,CAAC;EAC3C;EAEA,OAAOH,UAAU;AACnB,CAAC"}